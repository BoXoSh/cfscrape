sudo: required
dist: trusty
language: php
env:
    - V8VER=7.5

php:
  - 7.2
  - 7.3
  - 7.4

## Cache composer
cache:
  directories:
    - $HOME/.composer/cache

before_install:
    - sudo echo "deb http://ppa.launchpad.net/stesie/libv8/ubuntu bionic main" > /etc/apt/sources.list.d/stesie-libv8.list
    - sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 1A10946ED858A0DF
    - sudo apt-get update -yqq
    - sudo apt-get install -y libv8-$(V8VER)-dev

before_script:
  - git clone https://github.com/phpv8/v8js.git
  - cd v8js && phpize && ./configure LDFLAGS="-lstdc++" --with-v8js=/opt/libv8-$(V8VER) && $(MAKE) -j3 && $(MAKE) install install && cd ..
  - echo "extension = v8js.so" >> ~/.phpenv/versions/$(phpenv version-name)/etc/php.ini
  - travis_retry composer update ${COMPOSER_FLAGS} --no-interaction --prefer-dist

script:
  - vendor/bin/phpcs --standard=psr2 src/
  - vendor/bin/phpunit

